<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cek NIK</title>
</head>
<body>
  <div>
    <h2>Cek Data NIK</h2>
    <input type="text" id="nik" placeholder="Masukkan 16 digit NIK" />
    <button onclick="cariNIK()">Cari</button>
    <button onclick="randomNik()">Random NIK</button>

    <div id="hasil" style="display:none;"></div>
  </div>

  <script>
    async function cariNIK() {
      const nik = document.getElementById("nik").value.trim();
      const hasilDiv = document.getElementById("hasil");

      if (nik.length !== 16 || isNaN(nik)) {
        hasilDiv.style.display = "block";
        hasilDiv.innerHTML = "<p style='color:red'>NIK tidak valid!</p>";
        return;
      }

      try {
        const res = await fetch(`/nik?nik=${nik}`);
        const data = await res.json();

        if (res.ok) {
          hasilDiv.style.display = "block";
          hasilDiv.innerHTML = `
            <h3>Hasil Pencarian</h3>
            <p><strong>Tanggal Lahir:</strong> ${data.tanggal}</p>
            <p><strong>Jenis Kelamin:</strong> ${data.jenisKelamin}</p>
            <p><strong>Provinsi:</strong> ${data.provinsi}</p>
            <p><strong>Kab/Kota:</strong> ${data.kabkot}</p>
            <p><strong>Kecamatan:</strong> ${data.kecamatan}</p>
            <p><strong>Kode Pos:</strong> ${data.kodepos}</p>
            <p><strong>Uniqcode:</strong> ${data.uniqcode}</p>
          `;
        } else {
          hasilDiv.style.display = "block";
          hasilDiv.innerHTML = `<p style="color:red">${data.message}</p>`;
        }
      } catch (err) {
        hasilDiv.style.display = "block";
        hasilDiv.innerHTML = "<p style='color:red'>Terjadi kesalahan server.</p>";
      }
    }

   async function randomNik() {
  // 1. load database
  const res  = await fetch('/data.json');
  const data = await res.json();

  const provKey = '32';                              // bisa diganti 11,12,…,92
  const provName = data.provinsi[provKey];
  if (!provName) { alert('Kode provinsi salah'); return; }

  const kabKeys = Object.keys(data.kabkot)
                        .filter(k => k.startsWith(provKey));
  const kabKey  = kabKeys[Math.floor(Math.random() * kabKeys.length)];
  const kabName = data.kabkot[kabKey];
  const kecKeys = Object.keys(data.kecamatan)
                        .filter(k => k.startsWith(kabKey));
  const kecKey  = kecKeys[Math.floor(Math.random() * kecKeys.length)];
  const kecRaw  = data.kecamatan[kecKey];            
  const [kecName, kodePos] = kecRaw.split(' -- ');

  const dd   = String(Math.floor(Math.random() * 28) + 1).padStart(2,'0'); // 01-28
  const mm   = String(Math.floor(Math.random() * 12) + 1).padStart(2,'0');
  const yy   = String(Math.floor(Math.random() * 100)).padStart(2,'0');   // 00-99

  // (opsional) 50% perempuan → tambah 40
  const day  = Math.random() < 0.5 ? dd : String(parseInt(dd) + 40).padStart(2,'0');
  const uniq = String(Math.floor(Math.random() * 10000)).padStart(4,'0');

  // 6. susun NIK 16 digit
  const nik = provKey                       // 2 digit
            + kabKey.substring(2, 4)        // 2 digit
            + kecKey.substring(4, 6)        // 2 digit
            + day + mm + yy                 // 6 digit
            + uniq;                         // 4 digit

  // 7. tampilkan
  document.getElementById('nik').value     = nik;
  document.getElementById('kodepos').value = kodePos; 
  cariNIK();  
}
  </script>
</body>
</html>
